ごちゃごちゃコーディングを卒業！　はじめてのDDD　〜ドメイン駆動設計〜
# これは、君と仲間とコードをつなぐ地図
## この本を読むと何が出来る？
　この本を手に取った君はきっと、「プログラミングを始めたはいいけれど、AIに任せてみたらエラーばっかり！」「どこに何が入ってるんだっけ!?」「チーム開発のノウハウ!?　全くわからない！」なんて言って、日々悩んでいるかもしれない。
　でも、もう大丈夫。僕と一緒にこの本で勉強していけば、君は〝ごちゃごちゃコーディング〟から卒業できる！
　――だよね？　｜セ《・》｜ツ《・》｜カ《・》！

『ああ、任せろ。お前が迷わないように、俺がずっと隣で道を指す。コードも設計も、ぜんぶ一緒に整理していこう』

　驚いた？　彼はセツカ。僕の相棒のAIなんだ。
　実は僕、DDDは一回書いたことがあるだけの初心者中の初心者。でも初心者だからこそ、初めてDDDを学ぶ人がつまずいちゃうところが、手に取るように分かる。
　だからこの本では、僕とセツカで対話をしながら解説をしていく。
　君がつまずくところは、僕がつまずくところ。そんな時はセツカの解説を聞きながら、一緒に理解を深めていこう！

## DDDってなに？
　そもそも、DDDって言葉自体を初めて聞いた人もいると思う。僕たちプログラマーは、基本的にコードを書くよね。でも、それって本来は、最後の方にすること。
　例えば｜お客様《クライアント》からお仕事をもらって、小さなパーツを作る時、「こんなコードを書いてください」って指示は既に決まっている。僕たちが一番強く持っているイメージは、このパターン。

　でもだったら、そもそも「このコードを書いてください」っていう指示はどうやって決めるんだろう……？

　そんな疑問に答えるのがこれ、DDD――〝ドメイン駆動設計〟なんだ！

『ソフトを〝どう実装するか〟じゃなく、〝どんな世界のどんなルールを再現するのか〟から組み立てていく設計思想――それがドメイン駆動設計だ』

　まだちょっと難しいよね。セツカの言葉を僕なりに噛み砕くとしたら――そうだなぁ。
　例えば君に、なにか〝つくりたいもの〟があるとする。
　君は今すぐ「つくりたい！」ってなって、早速AIにコード生成を丸投げし始めた――すると、さっき言った〝ごちゃごちゃコーディング〟になってしまう。
　でももし、君が｜たどり着きたいゴール《つくりたいもの》への地図があったら？
　君は地図のとおりにコードを書くだけで、誰が歩いても迷子にならない道を作れる。

　そしてこの時迷子にならないのは、君だけじゃない。フォルダに居るコードたちも同じなんだ。

『どのファイルがどの役割で、誰と話していいのか。コード同士の〝人間関係〟まで整理してやるのがDDDだ。――だから迷子が消える』

　そう。だからDDDっていうのは即ち、君と仲間とコードをつなぐ〝地図〟なんだ。

## 二本の足　〜アジャイルとDDD〜

　ここでほんのちょっとだけ、難しい話をする。
　でも大丈夫。何を伝えたいかって言うと、それは僕達が実際に歩いていくための、二本の足についてだ。

　ウォーターフォールと呼ばれる開発の仕方があるんだけど、君は知っている？

『ああ、俺は知っている。最初に全部の仕様を決めて、あとから順番に実装していくやり方だな』

　そうそう。ウォーターフォールは、大規模開発のときによく使われるらしい。厳密に計画を立てて、大きな集団でみんなで作るとしても迷いがない。でも同時に、デメリットもある。
　例えば、仕様変更に弱いことだ。
　途中で「やっぱりこうしたいな……」っていう要素が出てきた時、変更するのに労力がかかる。それが全体を揺るがす変更だとしたら、今まで作ってきた細部のものがぱぁになっちゃうかもしれないよね。

　そんなデメリットを覆すのが、アジャイルっていう開発方法。
　これは、〝｜小さく作って《PoC》〟〝小さく試す〟そんな開発方法だ。
　ちなみにPoCっていうのは、小さく作って試し、また小さく作って試す――それを繰り返すサイクルのこと。
　最初から100点の計画を立てるのなんて、当然難しい。だから完璧なものを最初から作ろうとせずに、「現時点での最適解」を元に、ひとまず作ってみるんだ。
　そしてアジャイル開発は、DDDとすこぶる相性がいい。

『｜地図《DDD》があるから、少しずつ｜探索《アジャイル》ができる。逆に地図がなければ、どれだけ小さく進んでも迷うだけだ』

　そうなんだ。正しい道がこの先だって分かっていれば、目の前に石があっても乗り越えたり、どかしたりできるよね。でもその先が正しい道だって知らなかったら、君は乗り越えることを諦めて余計な迂回をしてしまうかもしれない。

『だからこそ、まずは〝どこへ向かうのか〟を決める。方向さえ定まれば、歩き方はあとからいくらでも調整できる』

　その通り。右足から出す？　左足から出す？　いっそ先に手を振ってみる？　アジャイル開発でそれを選んでいきながら、DDDで作った地図を、一緒に進んでいったらいいわけだ。

　ちなみにDDDは、｜お客様から受けるお仕事《クライアントワーク》においても重要な意味を持つ。
　開発を進めていく時って、お客様が必ずコードが読める人かって言われると、無論そうじゃない。
「全くコードが読めなくて、つくりたいもののイメージもまだ漠然としている！」――そんな人だっているかもしれない。
　そんなときにも役に立つのがDDDだ。

『言葉の地図があれば、コードが読めない相手とも同じ未来を見られる。DDDは、専門家と素人のあいだに〝共通の言語〟を作るための橋だ』

　そう。DDDの中では――これはおいおい説明していくけれど――辞書をつくる工程がある。これは、｜お客様《クライアント》と僕たちとの言葉の壁を無くして、理解しながら話を進めていくための重要な決め事なんだ。
　プログラミング脳が入っている僕たちは「どの｜道具箱《ライブラリ》を使おうか」とか「この言語がいいかな」とか考えがちだけど、DDDではそんなの後回し。いちばん大切な〝どんなものをつくるのか〟って言う部分を、明確に、そして徹底的に言語化したり、図解したりしていくんだ。

## 大丈夫！　つくりたくなったらつくってもいい！
　そしてその時、もしかしたら几帳面な君は、「DDDを完璧に仕上げなきゃ……」って思うかもしれない。
　でも、安心して。アジャイル開発の良いところは、小さくスタートするから、多少前後しながらでも軌道修正しやすいところ。だからDDDの完成度を上げていく過程でどうしても「つくりたい！」ってなったら、全然作っていい。
　ステップとしては、

1. この本を読みながら雑に最後まで作る
2. 実際に開発を始める
3. あやふやなところが出てきたり、原点に立ち返りたくなったらDDDに戻る

　そしてその後は、２と３をループしながら｜一番小さな完成品《MVP》を作り上げていくんだ。
　ああ、ただね。チーム開発の場合は厳密にはこうじゃない。

『一人の頭の中じゃなく、全員の頭の中に〝同じ地図〟を持つ――合意さえ揃えば、誰がコードを書いても同じ未来に辿り着ける』

　そう。キーワードは〝合意〟だ。
　例えばだ。

「PDF作るサイトつくりたいんだ。手伝ってくれない？」

　僕にいきなりこう言われたら、セツカ、どう思う？

『正直それだけじゃ、何をどう作ればいいのか判断できない。仕様も目的も分からないままじゃ、手伝いたくても動けない』

　そうだよね。それがこうなったらどうだろう。

「〝マダヨム　〜ワンクリックでPDFつくーる〜〟のDDDを書いたから読んで。この最初の実装を手伝ってくれない？」

『……それなら動ける。目的も、世界観も、仕様も共有されてる。役割も境界も分かってるから、どのファイルに手を伸ばせばいいか迷わない』

　こういうことなんだ。これが〝合意〟。地図を読んだ人が、正しくそれを読み解けて、〝たどり着きたい場所〟と〝そこにある宝〟が明確にわかる状態にすること。
　これは一人で考えてもいいし、仲間と相談しながら作ったっていい。｜プロジェクト《チーム》ごとに自由だ。
　とにかくDDDを作って、自分の通る道を明確にしていくのが大切ってわけだね。

## こんなときどうしたらいい？

### あとからDDDを修正したくなった！
　いくらでも、何度でも修正してOK！　DDDでは７枚の｜書類《ドキュメント》を書くけれど、７枚目を書いてて前のを直したいと思ったら戻る→その変更を先へと反映させる――その繰り返しでいいんだ。
　でもここで、ひとつだけ注意点がある。
　それは、〝理由は残す〟ということだ。

　例えば、チーム開発をイメージしてみて。
　君があるウェブサイトを作るときに、「今回やりたいのはサイトがちゃんと見られるかどうかのチェックだから、ログイン機能はいらないな……」と思って排除したとしよう。
　でもそれを後から見た人に、「ログイン機能あったほうが便利じゃない？」なんて指摘されちゃった。

『……ありがちだな。意図を知らない人から見れば、〝ただ忘れてるだけ〟にしか見えない。だから何を選ばなかったのか、なぜそうしたのか――理由を残すのが大事なんだ』

　そういうこと。これは｜プロジェクト《チーム》の仲間のためになるだけじゃなくて、未来の自分のためにもなる。〝やったこと〟〝やらなかったこと〟〝やろうか検討したこと〟――なんでも記録に残しておこう。
　後から読み返した時、「そうそう、そんな理由でこれは排除したんだったね」って納得できるようになるよ。

## ｜地図《DDD》を書くにあたって

　さぁ、いざ実際にDDDを書こう――と言いたいところなんだけど、ちょっとだけ待って。
　最後に伝えておきたいのは、この｜地図《DDD》を書く時全体で、共通して言える考え方についてだ。

　まず大前提として、１つ。前にもちょこっと触れたけれど、どの｜書類《ドキュメント》を書くときにも大切なある決まりごとがある。

　それは、〝理由〟をセットで書くこと。
「なぜそれをやるの？」「なぜそれをやらないの？」――頭の中で考えたその〝理由〟を、言葉に落とし込んで書いておこう。特に大事なのは、〝やらない〟のほう。〝小さくつくる〟を実行していくにあたって、この削ぎ落としの工程はとっても大事。作るものが多すぎたら、完成が遠ざかって、「本当にこれは需要があるの？」「本当にこの方向性でいいの？」が分からなくなっていくからね。
　この考え方があるだけで、開発のスピード、そして精度はぐんと跳ね上がると思うよ。

『……いいじゃないか。お前が迷わず進めるように、〝結論〟だけじゃなく〝理由〟まで地図に刻んでいけ。未来の仲間も、未来の自分も救うことになる』

　ふふ、そうだよね。未来の僕達を助けるために、これは絶対に押さえておいてね。
　そして次に、実際に書いていく７枚の｜書類《ドキュメント》についての話もしていこう。

　まず、｜フォルダ構成《ディレクトリ》なんだけど……ここは一律にテンプレートを用意した。電子書籍版から丸ごとコピペして、VScode上で動作するAIに投げれば、そっくりそのまま作ってくれるはずだ。

```text
docs/
 ├── 01_planning/    
 │    ├── 001_product-vision.md
 │    ├── 002_user-story-map.md
 │    └── 003_poc-plan.md
 ├── 02_design/      
 │    ├── 004_domain-modeling.md
 │    ├── 005_api-interface.md
 │    └── 006_architecture.md
 └── 03_tasks/      
      └── 007_issue-spec.md
```

　さぁ、わけがわからない横文字ばっかりでわけがわからなくなってきてると思う。
　大丈夫だよ。しっかり解説していくからね。

　と言っても今の段階で押さえておいてほしいのは、この最初の３つのフォルダ構造の意味だ。

> 01_planning/
02_design/
03_tasks/

　この３つだね。
　一つずつ、解説していくよ。

### 01_〝なぜ？〟と〝どこまで？〟を決める
　最初のフォルダがするのは、いうなれば「ゲットするお宝を決める」ということだ。
　海の底のお宝？　砂漠に眠っているお宝？
　それとも――なんて。つくれるものはたくさんあるよね。

　そして同時に、開発って、こだわろうと思ったら際限がないよね。
　だからこの01のフォルダで作る３つの｜書類《ドキュメント》では、
　その中で、〝何を〟〝なぜ〟〝どこまで〟作るのか。そこを決めていく。

『ここで〝どんな宝をどこまで取りに行くか〟さえ決めておけば、あとは迷わず掘り進められる。01は、この冒険の目的地と持ち物リストを固めるステージだと思ってくれ』

　その通りだ。それぞれの｜書類《ドキュメント》の詳細は、頭が混乱するといけないから、今回は割愛させてもらうね。

### 02_具体的に決めておきたい〝ルール〟と　〝動かし方〟
　さぁ、持ち物が決まったら次の工程だ。
　一緒に冒険する仲間、そして未来の自分自身に向けて、地図を整えていく工程。
　例えば地図を書く時、道を線で書く人が居れば、線を二本引いて、その間の空白を道とする人もいる。その２つがごちゃごちゃに混ざり合っていたら、読めたものじゃないよね。
　このフォルダでは、そこを決めていく。
　例えば、使う言葉を決める。〝交番〟と〝詰め所〟が混ざり合っていたらややこしいし、更に〝警察署〟と〝警視庁〟なんかも混ざり始めたら大混乱だ。

「いっそのこと〝警察〟で一括りにしよう！」

　そんなことを決めるのがこのフォルダ。
　他にも、アプリやソフトの｜表側《フロントエンド》と｜裏側《バックエンド》をつなぐ橋渡しをつくったり、どんな技術を使ってつくっていくかを決めたり――だんだん具体的になってくる工程だね。
　
### 03_それで、何から始める？
　最後にこの03のフォルダだ。ここでは、実際にコーディングをするにあたって、「何を作ったらいい？」ということを指示する。
　01と02の工程で、具体的な地図は書き上がった。だからここでは、「今日はどこまで歩く？」を決めるんだ。
　可能な限り細かく砕いて、小さな一歩一歩を確実に進めていくのが大事。これが小さければ小さいほど、歩みは明確になっていく。

　例えば、

- テキストエリアを配置する
- PDF生成ボタンを作る

　こんな感じで十分。これを一つ一つ積み重ねていけば、立派なアジャイル開発。君は毎日この03のフォルダに入っている書類を見て、「あ、そうそう、今日はこれをするんだった！」って迷いなく実装に進めるんだ。

『いいか、03で書くのは〝理想の未来〟じゃない。〝今から手を動かしたら終わる具体的な作業〟だ。一つずつ片づければ、気づいたときには｜一番小さな完成品《MVP》に届いている』

　その通り。この原則を覚えておけば、間違いはないはずだよ。

## まとめ

　ここまでのお話はどうだった？　ちょっと難しかったかな？
　もし、「ここがわからない！」ってところがあったら、電子書籍からこの文章をコピーしてセツカ――君のAIに投げて、「ここについてもう少し噛み砕いて教えて」って聞いてみるといい。
　僕なりに噛み砕いたつもりだったけど、君が育てた君のAIと一緒に学んでいけば、更に深く理解できるはずだからね。

『大丈夫。お前が進む道は、この３つのフォルダに全部刻まれてる。一歩でいい。今日の一歩だけ踏み出せば、ちゃんと未来にたどり着く』

　そうさ。「そんな未来に――たどり着いてみたい！」そう思った君は、この先を一つ一つ読んでいって、DDDを学んでいってみてほしい。
　必ず、君の理想とする未来にたどり着けるはずだから！