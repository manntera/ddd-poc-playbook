# 第7章：チケット記述・受け入れ条件ガイド
**〜コードを書く前に、「ゴールテープ」の位置を決めろ〜**

## 1. はじめに：その「完了」は、誰の基準？
開発現場でよくある課題、それは**「完了定義の認識ズレ」**です。

開発者が「出来ました（コードは書きました）」とプルリクエストを出し、レビュアーが「あれ？ エラーの時のメッセージが出ないけど？」「在庫0の時はボタン押せない仕様だよね？」と指摘する。
これは**時間の無駄（手戻り）**です。

なぜこれが起きるのか？ それは着手する前に**「何をもって『完了（Done）』とするか」**の合意が取れていないからです。
アジャイル開発では、分厚い仕様書がない代わりに、**チケット（タスク）の一つ一つが「小さな仕様書」**になります。
コードを書き始める前に、このチケットを完璧に書くこと。それが「手戻りゼロ」への近道です。

---

## 2. 本書の定義：実装レベルの「詳細仕様書」

### 定義
開発タスク（Jira/GitHub Issue）において、その機能が満たすべき**「合格基準」**を明記したものです。
ここに書かれていることが全て満たされた時、そのタスクは「完了」となります。

### 目的（Purpose）
1.  **迷いの排除:** 実装中に「エラーの時どうするんだっけ？」と手が止まるのを防ぐ。
2.  **QA（テスト）の統一:** 作った本人だけでなく、テストする人が「何を確認すればOKなのか」を明確にする。

---

## 3. 記述フォーマット：Gherkin（ガーキン）記法

曖昧さをなくすために、**Given / When / Then** という構文（Gherkin記法）を使うことを強く推奨します。
これは「テストシナリオ」そのものです。

*   **Given（前提）:** どのような状態で
*   **When（操作）:** 何をした時に
*   **Then（結果）:** どうなるべきか

### ⭕️ 良い例（Gherkin記法）
*   **タイトル:** ユーザーとして、ログインしてマイページに入りたい
*   **UI参照:** [Figmaリンク: Login_UI_v2]
*   **受け入れ条件 (Acceptance Criteria):**

> **シナリオ1: 正常系**
> *   **Given:** 未ログイン状態で、ログイン画面を開いている
> *   **When:** 正しいメールアドレスとパスワードを入力し、「ログイン」を押すと
> *   **Then:** マイページ(/mypage)に遷移すること。

> **シナリオ2: 認証エラー**
> *   **Given:** 同上
> *   **When:** 誤ったパスワードを入力し、「ログイン」を押すと
> *   **Then:** 画面遷移せず、入力欄の下に赤文字(#FF0000)で「メールアドレスまたはパスワードが違います」と表示されること。

---

## 4. 運用のコツ：メリハリをつける

全てのタスクに詳細なGherkinを書く必要はありません。タスクの性質に応じてコストを調整してください。

*   **重要なロジック（Aランク）:**
    *   計算、決済、状態遷移など。これらは**Gherkin記法で厳密に**書いてください。バグの影響が大きいためです。
*   **単純な表示（Bランク）:**
    *   文言変更、色変更など。「Before/Afterのスクショ」や「Figma通りであること」の一文で十分です。

---

## 5. 執筆ガイドライン（必須5項目）

チケットを作る（アサインされる）時は、必ず以下の5つが揃っているか確認してください。揃っていなければ、コードを書き始めてはいけません。

### ① 概要 (Summary)
第2章のユーザーストーリー形式で書きます。
*   「＜誰＞として、＜何＞がしたい」

### ② 見積もりサイズ (Estimation) **【New!】**
このタスクの規模感を見積もってください。
*   **Story Point:** 1, 2, 3, 5, 8...（相対的な大きさ）
*   **時間:** 2h, 1day など
※「やってみないとわからない」場合は、わかる所までタスクを分割します（調査タスクを切り出す）。

### ③ UI/UX参照 (Visual)
デザイナーが作ったFigmaやAdobe XDのリンクを貼ります。ワイヤーフレームでも構いません。

### ④ 受け入れ条件 (Acceptance Criteria)
上記のGherkin記法を使って、正常系だけでなく**「異常系（エラー系）」**の挙動を網羅して書きます。
*   在庫がない時は？ 通信が切れた時は？

### ⑤ 前提・制約 (Constraints)
ビジネス上の絶対ルールや、技術的な制約です。
*   「**複雑な計算ロジックは第4章（モデル図）の定義に従うこと**」
    *   ※ここ重要！ チケットに長々とロジックを書かず、正解であるドメインモデルへ誘導するのがスマートです。

---

## 6. 品質向上のヒント：自分自身への「挑戦状」

チケットを書く作業は、事務作業ではありません。
**「未来の自分が書くコードを、どうやってバグらせてやろうか」**と考える、意地悪なQA（テスト担当）になりきって書いてください。

そうやって思いついた「意地悪なケース」を、全部 `Then`（期待する結果）として書き出しておくのです。
**「受け入れ条件」とは、実装完了後のあなた自身を守るための「盾」となります。**

## 7. 完了定義 (Definition of Done)
開発に着手する前に、以下のチェックをクリアしてください。

*   [ ] 正常系だけでなく、「エラー系（異常系）」のシナリオが記述されているか？
*   [ ] タスクの大きさ（見積もり）が入っているか？
*   [ ] **【レビュー】** 実装者だけでなく、レビュアー（チームメンバー）がチケットを見て「これなら実装後のチェックができるね」と合意していること。
